<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="library">
	<select id="listTodo" resultType="todo">
		select
		todo_no as todoNo,
		todo_post_no as todoPostNo,
		todo_pro_no as todoProNo,
		todo_title as todoTitle,
		todo_content as todoContent,
		todo_writer as todoWriter,
		todo_member as todoMember,
		todo_start_date as todoStartDate,
		todo_end_date as todoEndDate,
		todo_progress as todoProgress,
		m1.member_name as todoWriterName,
        m2.member_name as todoMemberName,
        pro_title as todoProjectName
		from todo t, member m1, member m2, Project p
		where t.todo_writer = m1.member_no
        and t.todo_member = m2.member_no
        and t.todo_pro_no = p.pro_no
        and (todo_writer = #{memberNo} or todo_member = #{memberNo})
	</select>
	
	<select id="listDecision" resultType="decision">
		select
		dc_no as dcNo,
		dc_post_no as dcPostNo,
		dc_writer as dcWriter,
		dc_maker as dcMaker,
		dc_content as dcContent,
		dc_date as dcDate,
		dc_yn as dcYn,
		dc_decision as dcDecision,
		dc_comment as dcComment,
		dc_confirm_date as dcConfirmDate,
        post_title as dcPostTitle,
        m1.member_name as dcWriterName,
        m2.member_name as dcMakerName
		from decision d, post p, member m1, member m2
        where d.dc_post_no = p.post_no
        and d.dc_writer = m1.member_no
        and d.dc_maker = m2.member_no
		and (dc_writer = #{memberNo} or dc_maker = #{memberNo})
	</select>
	
	<select id="listProject" resultType="project">
		select
		w.pro_no as proNo,
		p.pro_title as proTitle
		from work_on w, project p
        where w.pro_no = p.PRO_NO
		and member_no = #{memberNo}
	</select>
	
	<select id="listImage" resultType="upload">
		select
        upload_no as uploadNo,
		post_no as postNo,
		member_no as memberNo,
		upload_date as uploadDate,
		upload_subject as uploadSubject,
		upload_path as uploadPath
		from upload
		where post_no in (select post_no from post where post_pro_no in (select pro_no from work_on where member_no=#{memberNo}))
		and upload_subject='이미지'
	</select>
	
	<select id="listFile" resultType="upload">
		select
        upload_no as uploadNo,
		u.post_no as postNo,
		member_no as memberNo,
		upload_date as uploadDate,
		upload_subject as uploadSubject,
		upload_path as uploadPath,
        p.post_title as postTitle
		from upload u, post p
		where u.post_no = p.post_no
        and u.post_no in (select post_no from post where post_pro_no in (select pro_no from work_on where member_no=#{memberNo}))
		and upload_subject='파일'
	</select>
	
	<select id="listLink" resultType="link">
		select
		link_no as linkNo,
		post_no as postNo,
		l.member_no as memberNo,
		link_date as linkDate,
		link_title as linkTitle,
		link_address as linkAddress,
        m.member_name as memberName
		from link l, member m
        where l.member_no = m.member_no
        and post_no in (select post_no from post where post_pro_no in (select pro_no from work_on where member_no=#{memberNo}))
	</select>
	
	<select id="selectMemberList" resultType="member">
		select
		w.member_no as memberNo,
        member_name as memberName
		from work_on w, member m
        where w.member_no = m.member_no
		and pro_no = #{proNo}
	</select>
	
	<insert id="insertTodo" parameterType="todo">
		insert into todo values (
		todo_seq.nextval, null, #{todoProNo}, #{todoTitle}, 
		<choose>
			<when test="todoContent!=null">
				#{todoContent}
			</when>
			<otherwise>
				null
			</otherwise>
		</choose>
		, #{todoWriter}, #{todoMember}, null, null,'suggest')
	</insert>
	
	<select id="listTodoMe" resultType="todo">
		select
		todo_no as todoNo,
		todo_post_no as todoPostNo,
		todo_pro_no as todoProNo,
		todo_title as todoTitle,
		todo_content as todoContent,
		todo_writer as todoWriter,
		todo_member as todoMember,
		todo_start_date as todoStartDate,
		todo_end_date as todoEndDate,
		todo_progress as todoProgress,
		m1.member_name as todoWriterName,
        m2.member_name as todoMemberName,
        pro_title as todoProjectName
		from todo t, member m1, member m2, Project p
		where t.todo_writer = m1.member_no
        and t.todo_member = m2.member_no
        and t.todo_pro_no = p.pro_no
        and todo_member = #{memberNo}
	</select>
	
	<select id="listTodoRequest" resultType="todo">
		select
		todo_no as todoNo,
		todo_post_no as todoPostNo,
		todo_pro_no as todoProNo,
		todo_title as todoTitle,
		todo_content as todoContent,
		todo_writer as todoWriter,
		todo_member as todoMember,
		todo_start_date as todoStartDate,
		todo_end_date as todoEndDate,
		todo_progress as todoProgress,
		m1.member_name as todoWriterName,
        m2.member_name as todoMemberName,
        pro_title as todoProjectName
		from todo t, member m1, member m2, Project p
		where t.todo_writer = m1.member_no
        and t.todo_member = m2.member_no
        and t.todo_pro_no = p.pro_no
        and todo_writer = #{memberNo}
	</select>
	
	<select id="listDcMe" resultType="decision">
		select
		dc_no as dcNo,
		dc_post_no as dcPostNo,
		dc_writer as dcWriter,
		dc_maker as dcMaker,
		dc_content as dcContent,
		dc_date as dcDate,
		dc_yn as dcYn,
		dc_decision as dcDecision,
		dc_comment as dcComment,
		dc_confirm_date as dcConfirmDate,
        post_title as dcPostTitle,
        m1.member_name as dcWriterName,
        m2.member_name as dcMakerName
		from decision d, post p, member m1, member m2
        where d.dc_post_no = p.post_no
        and d.dc_writer = m1.member_no
        and d.dc_maker = m2.member_no
		and dc_maker = #{memberNo}
	</select>
	
	<select id="listDcRequest" resultType="decision">
		select
		dc_no as dcNo,
		dc_post_no as dcPostNo,
		dc_writer as dcWriter,
		dc_maker as dcMaker,
		dc_content as dcContent,
		dc_date as dcDate,
		dc_yn as dcYn,
		dc_decision as dcDecision,
		dc_comment as dcComment,
		dc_confirm_date as dcConfirmDate,
        post_title as dcPostTitle,
        m1.member_name as dcWriterName,
        m2.member_name as dcMakerName
		from decision d, post p, member m1, member m2
        where d.dc_post_no = p.post_no
        and d.dc_writer = m1.member_no
        and d.dc_maker = m2.member_no
		and dc_writer = #{memberNo}
	</select>
	
	<select id="listImageMe" resultType="upload">
		select
		upload_no as uploadNo,
		u.post_no as postNo,
		member_no as memberNo,
		upload_date as uploadDate,
		upload_subject as uploadSubject,
		upload_path as uploadPath,
		p.post_title as postTitle
		from upload u, post p
		where u.post_no = p.post_no
		and member_no = #{memberNo}
		and upload_subject='이미지'
	</select>
	
	<select id="listFileMe" resultType="upload">
		select
		upload_no as uploadNo,
		u.post_no as postNo,
		member_no as memberNo,
		upload_date as uploadDate,
		upload_subject as uploadSubject,
		upload_path as uploadPath,
		p.post_title as postTitle
		from upload u, post p
		where u.post_no = p.post_no
		and member_no = #{memberNo}
		and upload_subject='파일'
	</select>
	
	<select id="listLinkMe" resultType="link">
		select
		link_no as linkNo,
		post_no as postNo,
		l.member_no as memberNo,
		link_date as linkDate,
		link_title as linkTitle,
		link_address as linkAddress,
        m.member_name as memberName
		from link l, member m
        where l.member_no = m.member_no
		and m.member_no = #{memberNo}
	</select>
	
	<select id="privateNo" resultType="int">
		select min(pro_no) from project where pro_member_no = #{memberNo}
	</select>
	
	<update id="updateDecision" parameterType="decision">
		update decision set dc_yn='Y', dc_decision=#{dcDecision}, dc_comment=#{dcComment} where dc_no=#{dcNo}
	</update>
	
	<update id="updateTodo" parameterType="todo">
		update todo set todo_title=#{todoTitle}, todo_content=#{todoContent}, todo_member=#{todoMember} where todo_no=#{todoNo}
	</update>
	
	<select id="todoContentMemberPost" resultType="member">
		select distinct
		w.member_no as memberNo,
        member_name as memberName
		from work_on w, member m, post p
        where w.member_no = m.member_no
		and pro_no = (select post_pro_no from post where post_no = 2) order by 1
	</select>

</mapper>
